{% extends 'store/base.html' %}
{% load static %}

{% block title %}Order Confirmation - MyEcommerce{% endblock %}

{% block extra_css %}
<style>
:root {
    --primary-color: #6366f1;
    --primary-dark: #4f46e5;
    --primary-light: #a5b4fc;
    --secondary-color: #f1f5f9;
    --success-color: #10b981;
    --success-dark: #059669;
    --warning-color: #f59e0b;
    --danger-color: #ef4444;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --text-muted: #94a3b8;
    --border-color: #e2e8f0;
    --white: #ffffff;
    --gray-50: #f8fafc;
    --gray-100: #f1f5f9;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --radius-sm: 0.375rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
    --radius-2xl: 1.5rem;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

* {
    box-sizing: border-box;
}

body {
    background: linear-gradient(135deg, var(--gray-50) 0%, var(--white) 100%);
    min-height: 100vh;
}

.success-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem 1rem;
    text-align: center;
    position: relative;
}

@media (min-width: 768px) {
    .success-container {
        padding: 3rem 2rem;
    }
}

.success-header {
    position: relative;
    margin-bottom: 3rem;
    padding: 3rem 2rem;
    background: linear-gradient(135deg, var(--success-color) 0%, var(--success-dark) 100%);
    border-radius: var(--radius-2xl);
    color: var(--white);
    overflow: hidden;
}

.success-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.2) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(255,255,255,0.1) 0%, transparent 50%);
    animation: float 6s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.success-icon {
    font-size: clamp(3rem, 8vw, 5rem);
    margin-bottom: 1.5rem;
    position: relative;
    z-index: 1;
    animation: checkmark 0.8s ease-in-out;
}

@keyframes checkmark {
    0% { transform: scale(0) rotate(180deg); opacity: 0; }
    50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

.success-title {
    font-size: clamp(1.875rem, 5vw, 3rem);
    font-weight: 800;
    margin-bottom: 1rem;
    position: relative;
    z-index: 1;
}

.success-subtitle {
    font-size: clamp(1rem, 3vw, 1.25rem);
    opacity: 0.95;
    position: relative;
    z-index: 1;
    line-height: 1.6;
}

.order-info {
    background: var(--white);
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-xl);
    padding: 2rem;
    margin: 2rem 0;
    text-align: left;
    border: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
}

.order-info::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary-color), var(--success-color));
}

.order-header {
    border-bottom: 2px solid var(--success-color);
    padding-bottom: 1.5rem;
    margin-bottom: 2rem;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: flex-end;
    gap: 1rem;
}

.order-id {
    font-size: clamp(1.125rem, 3vw, 1.5rem);
    font-weight: 700;
    color: var(--text-primary);
}

.order-date {
    color: var(--text-secondary);
    font-size: 1rem;
    font-weight: 500;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.info-card {
    background: var(--gray-50);
    border-radius: var(--radius-xl);
    padding: 1.5rem;
    border: 1px solid var(--border-color);
    transition: var(--transition);
    position: relative;
}

.info-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.info-card-title {
    font-weight: 600;
    font-size: 1.125rem;
    margin-bottom: 1rem;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.info-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.75rem;
    padding: 0.5rem 0;
    align-items: flex-start;
    gap: 1rem;
}

.info-row:last-child {
    margin-bottom: 0;
}

.info-label {
    font-weight: 500;
    color: var(--text-primary);
    font-size: 0.875rem;
    min-width: 80px;
    flex-shrink: 0;
}

.info-value {
    color: var(--text-secondary);
    font-size: 0.875rem;
    text-align: right;
    word-break: break-word;
    line-height: 1.5;
}

.tracking-info {
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
    border-left: 4px solid var(--primary-color);
    padding: 1.5rem;
    margin: 2rem 0;
    border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
    font-size: 1rem;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 1rem;
    justify-content: center;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: var(--transition);
}

.status-pending {
    background: rgba(245, 158, 11, 0.1);
    color: #d97706;
    border: 1px solid rgba(245, 158, 11, 0.2);
}

.status-confirmed {
    background: rgba(16, 185, 129, 0.1);
    color: #059669;
    border: 1px solid rgba(16, 185, 129, 0.2);
}

.status-processing {
    background: rgba(99, 102, 241, 0.1);
    color: #5b21b6;
    border: 1px solid rgba(99, 102, 241, 0.2);
}

.status-shipped {
    background: rgba(59, 130, 246, 0.1);
    color: #1d4ed8;
    border: 1px solid rgba(59, 130, 246, 0.2);
}

.status-delivered {
    background: rgba(34, 197, 94, 0.1);
    color: #15803d;
    border: 1px solid rgba(34, 197, 94, 0.2);
}

.order-items {
    margin: 2rem 0;
}

.order-items-title {
    margin-top: 2rem;
    margin-bottom: 1.5rem;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    transition: var(--transition);
    border-radius: var(--radius-lg);
    margin-bottom: 0.5rem;
}

.item:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.item:hover {
    background: var(--gray-50);
    transform: translateX(4px);
}

.item-image {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: var(--radius-lg);
    background: var(--gray-100);
    border: 2px solid var(--border-color);
    transition: var(--transition);
}

.item:hover .item-image {
    border-color: var(--primary-color);
    transform: scale(1.05);
}

.item-details {
    flex: 1;
    min-width: 0;
}

.item-name {
    font-weight: 600;
    margin-bottom: 0.5rem;
    font-size: 1.125rem;
    color: var(--text-primary);
    line-height: 1.4;
}

.item-info {
    color: var(--text-secondary);
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.item-total {
    font-weight: 700;
    color: var(--success-color);
    min-width: 100px;
    text-align: right;
    font-size: 1.25rem;
}

.total-section {
    background: var(--gray-50);
    border-radius: var(--radius-xl);
    padding: 2rem;
    margin-top: 2rem;
    border: 1px solid var(--border-color);
}

.total-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    font-size: 1.125rem;
    padding: 0.5rem 0;
}

.total-row:last-child {
    margin-bottom: 0;
}

.total-row.grand-total {
    border-top: 2px solid var(--success-color);
    padding-top: 1.5rem;
    margin-top: 1.5rem;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

.total-row .text-success {
    color: var(--success-color);
    font-weight: 600;
}

.order-notes {
    margin-top: 2rem;
    background: var(--gray-50);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    color: var(--text-secondary);
    font-size: 1rem;
    border: 1px solid var(--border-color);
    line-height: 1.6;
}

.order-notes strong {
    color: var(--text-primary);
    display: block;
    margin-bottom: 0.5rem;
}

.action-buttons {
    margin-top: 3rem;
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
}

.btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 2rem;
    border: none;
    border-radius: 9999px;
    font-size: 1rem;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    white-space: nowrap;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.btn:hover::before {
    left: 100%;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: var(--white);
    box-shadow: var(--shadow-md);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    color: var(--white);
}

.btn-success {
    background: linear-gradient(135deg, var(--success-color), var(--success-dark));
    color: var(--white);
    box-shadow: var(--shadow-md);
}

.btn-success:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    color: var(--white);
}

.btn-outline-primary {
    border: 2px solid var(--primary-color);
    color: var(--primary-color);
    background: transparent;
}

.btn-outline-primary:hover {
    background: var(--primary-color);
    color: var(--white);
    transform: translateY(-2px);
}

.help-section {
    margin-top: 3rem;
    text-align: center;
    padding: 2rem;
    background: var(--white);
    border-radius: var(--radius-xl);
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-sm);
}

.help-section p {
    color: var(--text-secondary);
    font-size: 1.125rem;
    margin-bottom: 1rem;
    line-height: 1.6;
}

.help-section a {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 600;
    transition: var(--transition);
}

.help-section a:hover {
    color: var(--primary-dark);
    text-decoration: underline;
}
/* Mobile-first responsive design */
@media (max-width: 640px) {
    .success-container {
        padding: 1rem 0.5rem;
    }
    
    .success-header {
        margin-bottom: 2rem;
        padding: 2rem 1rem;
    }
    
    .order-info {
        padding: 1.5rem;
        margin: 1.5rem 0;
    }
    
    .order-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .info-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .info-card {
        padding: 1rem;
    }
    
    .info-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .info-value {
        text-align: left;
    }
    
    .tracking-info {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
        padding: 1rem;
    }
    
    .item {
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 1rem;
        padding: 1.5rem 1rem;
    }
    
    .item-image {
        width: 100px;
        height: 100px;
    }
    
    .item-details {
        text-align: center;
    }
    
    .item-total {
        text-align: center;
        font-size: 1.5rem;
    }
    
    .total-section {
        padding: 1.5rem;
    }
    
    .action-buttons {
        flex-direction: column;
        gap: 1rem;
        margin-top: 2rem;
    }
    
    .btn {
        justify-content: center;
        padding: 1rem 2rem;
        font-size: 1.125rem;
    }
    
    .help-section {
        padding: 1.5rem;
        margin-top: 2rem;
    }
}

@media (min-width: 641px) and (max-width: 768px) {
    .info-grid {
        grid-template-columns: 1fr;
    }
    
    .action-buttons {
        flex-wrap: wrap;
        justify-content: center;
    }
}

@media (min-width: 769px) and (max-width: 1024px) {
    .item {
        padding: 1.25rem;
    }
}

@media (min-width: 1025px) {
    .order-info:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-xl);
    }
    
    .action-buttons {
        justify-content: center;
    }
}

/* Loading states */
.loading {
    opacity: 0.7;
    pointer-events: none;
}

.loading .order-info {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 0.9; }
}

/* Focus styles for accessibility */
.btn:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

.order-info:focus-within {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

/* Print styles */
@media print {
    .action-buttons,
    .help-section,
    .success-header::before {
        display: none !important;
    }
    
    .order-info {
        break-inside: avoid;
        box-shadow: none;
        border: 1px solid #000;
    }
    
    .success-header {
        background: none !important;
        color: #000 !important;
    }
    
    .success-icon {
        color: #000 !important;
    }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
    :root {
        --white: #1e293b;
        --gray-50: #334155;
        --gray-100: #475569;
        --text-primary: #f1f5f9;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;
        --border-color: #475569;
    }
}

/* Animation enhancements */
.success-container > * {
    animation: fadeInUp 0.6s ease-out;
}

.success-container > *:nth-child(2) {
    animation-delay: 0.1s;
}

.success-container > *:nth-child(3) {
    animation-delay: 0.2s;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
{% endblock %}

{% block content %}
<div class="success-container">
    <div class="success-header">
        <div class="success-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="success-title">Order Confirmed!</div>
        <div class="success-subtitle">Thank you for your purchase. Your order has been successfully placed.</div>
    </div>

    <div class="order-info">
        <div class="order-header">
            <div class="order-id">Order #{{ order.order_id }}</div>
            <div class="order-date">Placed on {{ order.created_at|date:"F d, Y" }} at {{ order.created_at|time:"g:i A" }}</div>
        </div>
        
        <div class="info-grid">
            <div class="info-card">
                <div class="info-card-title">
                    <i class="fas fa-user"></i>Billing Information
                </div>
                <div class="info-row">
                    <span class="info-label">Name:</span>
                    <span class="info-value">{{ order.first_name }} {{ order.last_name }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Email:</span>
                    <span class="info-value">{{ order.email }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Phone:</span>
                    <span class="info-value">{{ order.phone }}</span>
                </div>
            </div>
            <div class="info-card">
                <div class="info-card-title">
                    <i class="fas fa-shipping-fast"></i>Shipping Information
                </div>
                <div class="info-row">
                    <span class="info-label">Address:</span>
                    <span class="info-value">
                        {{ order.shipping_address }}
                        <br>
                        {{ order.shipping_city }}, {{ order.shipping_state }}, {{ order.shipping_postal_code }}<br>
                        {{ order.shipping_country }}
                    </span>
                </div>
                {% if order.shipping_phone %}
                <div class="info-row">
                    <span class="info-label">Phone:</span>
                    <span class="info-value">{{ order.shipping_phone }}</span>
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="tracking-info">
            <div><strong>Order Status:</strong></div>
            <span class="status-badge status-{{ order.status }}">{{ order.get_status_display }}</span>
            <div><strong>Payment:</strong></div>
            <div>{{ order.payment.get_payment_method_display }} - {{ order.payment.get_status_display }}</div>
        </div>

        <div class="order-items-title">
            <i class="fas fa-box"></i>Order Items
        </div>
        <div class="order-items">
            {% for item in order.order_items.all %}
            <div class="item">
                {% if item.product.image %}
                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="item-image">
                {% else %}
                <div class="item-image bg-light d-flex align-items-center justify-content-center">
                    <i class="fas fa-image text-muted"></i>
                </div>
                {% endif %}
                <div class="item-details">
                    <div class="item-name">{{ item.product.name }}</div>
                    <div class="item-info">Quantity: {{ item.quantity }} Ã— ${{ item.price }}</div>
                </div>
                <div class="item-total">${{ item.total_price }}</div>
            </div>
            {% endfor %}
        </div>
        <div class="total-section">
            <div class="total-row">
                <span>Subtotal:</span>
                <span>${{ order.total_amount }}</span>
            </div>
            {% if order.shipping_cost > 0 %}
            <div class="total-row">
                <span>Shipping:</span>
                <span>${{ order.shipping_cost }}</span>
            </div>
            {% endif %}
            {% if order.coupon_usage %}
            <div class="total-row">
                <span>Discount ({{ order.coupon_usage.coupon.code }}):</span>
                <span class="text-success">-${{ order.coupon_usage.discount_amount }}</span>
            </div>
            {% endif %}
            {% if order.tax_amount > 0 %}
            <div class="total-row">
                <span>Tax:</span>
                <span>${{ order.tax_amount }}</span>
            </div>
            {% endif %}
            <div class="total-row grand-total">
                <span>Total:</span>
                <span>${{ order.grand_total }}</span>
            </div>
        </div>
        {% if order.order_notes %}
        <div class="order-notes">
            <strong>Order Notes:</strong>
            <div>{{ order.order_notes }}</div>
        </div>
        {% endif %}
    </div>
    <div class="action-buttons">
        <a href="{% url 'payment:order_detail' order.order_id %}" class="btn btn-primary">
            <i class="fas fa-eye"></i> View Order Details
        </a>
        <a href="{% url 'payment:order_tracking' order.order_id %}" class="btn btn-outline-primary">
            <i class="fas fa-truck"></i> Track Order
        </a>
        <a href="{% url 'store:home' %}" class="btn btn-success">
            <i class="fas fa-shopping-bag"></i> Continue Shopping
        </a>
    </div>
    <div class="help-section">
        <p>
            <i class="fas fa-question-circle"></i>
            Need help? <a href="https://t.me/chamroeun_exe" target="_blank" rel="noopener noreferrer">Contact our support team</a>
        </p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const isMobile = window.innerWidth <= 768;
    
    // Enhanced success animation
    const successIcon = document.querySelector('.success-icon');
    const successTitle = document.querySelector('.success-title');
    const successSubtitle = document.querySelector('.success-subtitle');
    
    // Staggered animations
    setTimeout(() => {
        successIcon.style.animation = 'checkmark 0.8s ease-in-out';
    }, 200);
    
    setTimeout(() => {
        successTitle.style.animation = 'fadeInUp 0.6s ease-out';
    }, 600);
    
    setTimeout(() => {
        successSubtitle.style.animation = 'fadeInUp 0.6s ease-out';
    }, 800);
    
    // Intersection Observer for order info animation
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const infoObserver = new IntersectionObserver((entries) => {
        entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
                setTimeout(() => {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }, index * 150);
            }
        });
    }, observerOptions);
    
    // Animate order info sections
    const animatedElements = document.querySelectorAll('.order-info, .info-card, .item, .action-buttons');
    animatedElements.forEach(element => {
        element.style.opacity = '0';
        element.style.transform = 'translateY(30px)';
        element.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        infoObserver.observe(element);
    });
    
    // Button ripple effects
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(button => {
        button.addEventListener('click', function(e) {
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                left: ${x}px;
                top: ${y}px;
                background: rgba(255, 255, 255, 0.6);
                border-radius: 50%;
                transform: scale(0);
                animation: ripple 0.6s ease-out;
                pointer-events: none;
            `;
            
            this.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
        });
    });
    
    // Copy order ID functionality
    const orderIdElement = document.querySelector('.order-id');
    if (orderIdElement) {
        orderIdElement.style.cursor = 'pointer';
        orderIdElement.title = 'Click to copy order ID';
        
        orderIdElement.addEventListener('click', async function() {
            const orderIdMatch = this.textContent.match(/#(.+)/);
            if (orderIdMatch) {
                try {
                    await navigator.clipboard.writeText(orderIdMatch[1]);
                    showNotification('Order ID copied to clipboard!', 'success');
                } catch (err) {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = orderIdMatch[1];
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showNotification('Order ID copied to clipboard!', 'success');
                }
            }
        });
    }
    
    // Enhanced mobile interactions
    if (isMobile) {
        // Touch feedback for info cards
        const infoCards = document.querySelectorAll('.info-card');
        infoCards.forEach(card => {
            card.addEventListener('touchstart', function() {
                this.style.transform = 'scale(0.98)';
            });
            
            card.addEventListener('touchend', function() {
                this.style.transform = '';
            });
        });
        
        // Pull to refresh functionality
        let startY = 0;
        let currentY = 0;
        let isDragging = false;
        
        document.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
            isDragging = true;
        });
        
        document.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            currentY = e.touches[0].clientY;
            const deltaY = currentY - startY;
            
            if (deltaY > 100 && window.scrollY === 0) {
                document.body.style.transform = `translateY(${deltaY * 0.3}px)`;
                document.body.style.opacity = `${1 - (deltaY * 0.002)}`;
            }
        });
        
        document.addEventListener('touchend', () => {
            if (isDragging) {
                const deltaY = currentY - startY;
                if (deltaY > 150 && window.scrollY === 0) {
                    location.reload();
                } else {
                    document.body.style.transform = '';
                    document.body.style.opacity = '';
                }
                isDragging = false;
            }
        });
    }
    
    // Auto-redirect to order tracking after 30 seconds
    setTimeout(() => {
        if (confirm('Would you like to track your order now? This will redirect you to the order tracking page.')) {
            const trackingButton = document.querySelector('.btn-outline-primary');
            if (trackingButton) {
                trackingButton.click();
            }
        }
    }, 30000);
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 'p':
                    e.preventDefault();
                    window.print();
                    break;
                case 'd':
                    e.preventDefault();
                    const detailsBtn = document.querySelector('.btn-primary');
                    if (detailsBtn) detailsBtn.click();
                    break;
                case 't':
                    e.preventDefault();
                    const trackBtn = document.querySelector('.btn-outline-primary');
                    if (trackBtn) trackBtn.click();
                    break;
                case 'h':
                    e.preventDefault();
                    const homeBtn = document.querySelector('.btn-success');
                    if (homeBtn) homeBtn.click();
                    break;
            }
        }
    });
    
    // Status badge animation
    const statusBadge = document.querySelector('.status-badge');
    if (statusBadge) {
        statusBadge.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.05)';
        });
        
        statusBadge.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
    }
    
    // Item image hover effects
    const itemImages = document.querySelectorAll('.item-image');
    itemImages.forEach(img => {
        img.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.1) rotate(2deg)';
        });
        
        img.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1) rotate(0deg)';
        });
    });
    
    // Notification function
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? 'var(--success-color)' : 'var(--primary-color)'};
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            animation: slideInRight 0.3s ease;
            font-weight: 500;
        `;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }
    
    // Performance optimization: Lazy load images
    const images = document.querySelectorAll('.item-image');
    const imageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                if (img.dataset.src) {
                    img.src = img.dataset.src;
                    img.removeAttribute('data-src');
                    imageObserver.unobserve(img);
                }
            }
        });
    });
    
    images.forEach(img => imageObserver.observe(img));
});

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes ripple {
        to { transform: scale(2); opacity: 0; }
    }
    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);

// Service worker registration for offline support
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/sw.js')
            .then(registration => {
                console.log('SW registered: ', registration);
            })
            .catch(registrationError => {
                console.log('SW registration failed: ', registrationError);
            });
    });
}
</script>
{% endblock %}