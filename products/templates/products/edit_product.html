{% extends 'store/base.html' %}

{% block title %}Edit {{ product.name }} - E-commerce App{% endblock %}

{% block content %}
<h1>Edit Product</h1>

<div class="form-container" style="max-width: 520px; margin: 0 auto;">
    <form method="post" enctype="multipart/form-data" style="display: flex; flex-direction: column; gap: 1.2rem;">
        {% csrf_token %}
        {{ form.as_p }}
        <div style="margin-top: 1.2rem; text-align: center;">
            <h3 style="margin-bottom: 0.7rem;">Current Image:</h3>
            {% if product.image %}
                <img id="preview-image" src="{{ product.image.url }}" alt="{{ product.name }}" style="max-width: 200px; border-radius: 8px; box-shadow: 0 2px 10px 0 rgba(40,40,90,0.10); margin-left: auto; margin-right: auto; display: block;">
            {% else %}
                <img id="preview-image" src="" alt="No image" style="display:none; max-width: 200px; border-radius: 8px; margin-left: auto; margin-right: auto; display: block;">
            {% endif %}
        </div>
        <div style="align-self: center; display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 1.5rem;">
            <button type="submit" class="btn btn-primary">Update</button>
            <a href="{% url 'products:product_detail' product.id %}" class="btn btn-secondary">Cancel</a>
            <a href="{% url 'store:dashboard' %}" class="btn btn-secondary">Back</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var input = document.getElementById('id_image');
    var preview = document.getElementById('preview-image');
    if (input && preview) {
        input.addEventListener('change', function(event) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        });
    }
});
</script>
{% endblock %}